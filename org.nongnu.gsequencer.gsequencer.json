{
    "app-id": "org.nongnu.gsequencer.gsequencer",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.34",
    "sdk": "org.gnome.Sdk",
    "command": "gsequencer",
    "rename-desktop-file": "gsequencer.desktop",
    "copy-icon": true,
    "rename-appdata-file": "org.nongnu.gsequencer.gsequencer.appdata.xml",
    "rename-icon": "gsequencer",
    "finish-args": [
        /* X11 + XShm access */
        "--share=ipc",
        "--socket=x11",
        /* Note playback */
        "--socket=pulseaudio",
        /* Soundcard and MIDI */
        "--device=all",
        /* Allow loading, saving files from anywhere (portals donâ€™t work yet) */
        "--filesystem=host",
        "--env=AGS_LICENSE_FILENAME=/app/share/gsequencer/GPL-3",
        "--env=AGS_ONLINE_HELP_START_FILENAME=file:///app/share/doc/gsequencer-doc/html/index.html",
        "--env=LADSPA_PATH=/app/lib/ladspa",
        "--env=DSSI_PATH=/app/lib/dssi",
        "--env=LV2_PATH=/app/lib/lv2"
    ],
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share/man",
        "/share/doc",
        "/share/gtk-doc",
        "*.la"
    ],
    "modules": [
        "shared-modules/gtk2/gtk2.json",
        {
            "name": "ladspa",
            "no-autogen": true,
            "subdir": "src",
            "make-install-args": [
                "INSTALL_PLUGINS_DIR=/app/lib/ladspa",
                "INSTALL_INCLUDE_DIR=/app/include",
                "INSTALL_BINARY_DIR=/app/bin"
            ],
            "cleanup": [
                "/bin"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.ladspa.org/download/ladspa_sdk_1.15.tgz",
                    "sha256": "4229959b09d20c88c8c86f4aa76427843011705df22d9c28b38359fd1829fded"
                }
            ]
        },
        
        {
            "name": "fftw3f",
            "config-opts": [
                "--enable-threads",
                "--enable-shared",
                "--enable-float",
                "--disable-static"
            ],
            "build-options": {
                "arch": {
                    "x86_64": {
                        "config-opts": [
                            "--enable-sse2",
                            "--enable-avx",
                            "--enable-avx-128-fma"
                        ]
                    }
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.fftw.org/fftw-3.3.7.tar.gz",
                    "sha256": "3b609b7feba5230e8f6dd8d245ddbefac324c5a6ae4186947670d9ac2cd25573"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.la"
            ]
        },
        "shared-modules/python2.7/python-2.7.json",
        {
            "name": "jack2",
            "buildsystem": "simple",
            "build-commands": [
                "./waf configure --prefix=/app --htmldir=/app/share/doc/jack/ --freebob=no --classic",
                "./waf build -j $FLATPAK_BUILDER_N_JOBS",
                "./waf install"
            ],
            "cleanup": [
                "/bin",
                "/share",
                "/lib/jack",
                "/lib/libjackserver.so*"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jackaudio/jack2/releases/download/v1.9.12/jack2-1.9.12.tar.gz",
                    "sha256": "deefe2f936dc32f59ad3cef7e37276c2035ef8a024ca92118f35c9a292272e33"
                }
            ]
        },
        {
            "name": "liblo",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://download.sf.net/sourceforge/liblo/liblo-0.29.tar.gz",
                    "sha256": "ace1b4e234091425c150261d1ca7070cece48ee3c228a5612d048116d864c06a"
                }
            ]
        },
        {
            "name": "dssi",
            "rm-configure": true,
            "config-opts": [
                "--disable-static"
            ],
            "cleanup": [
                "/bin"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://download.sf.net/sourceforge/dssi/dssi-1.1.1.tar.gz",
                    "sha256": "f2c82b073a947c8255284249097667f9b14e660bf86186f3fcd3b3b3e087814e"
                },
                {
                    "type": "script",
                    "commands": [
                        "autoreconf -fiv"
                    ],
                    "dest-filename": "autogen.sh"
                }
            ]
        },

        {
            "name": "audiofile",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://audiofile.68k.org/audiofile-0.3.6.tar.gz",
                    "sha256": "cdc60df19ab08bfe55344395739bb08f50fc15c92da3962fac334d3bff116965"
                },
                {
                    "type": "patch",
                    "path": "patches/audiofile-gcc6.patch"
                }
            ]
        },
        
        {
            "name": "libinstpatch",
            "rm-configure": true,
            "sources": [
                {
                    "type": "archive",
                    "url": "https://downloads.sourceforge.net/project/swami/libinstpatch/1.0.0/libinstpatch-1.0.0.tar.gz",
                    "sha256": "8943e2226d97609104365f0105be87b326a0b2335cea22d29604a45f8ef1cee7"
                },
                {
                    "type": "patch",
                    "strip-components": 0,
                    "path": "patches/instpatch.examples.patch"
                },
                {
                    "type": "script",
                    "commands": [
                        "autoreconf -fiv"
                    ],
                    "dest-filename": "autogen.sh"
                }
            ]
        },
        
        {
            "name": "lv2",
            "buildsystem": "simple",
            "build-commands": [
                "./waf configure --prefix=/app --libdir=/app/lib --docdir=/app/share/doc/lv2",
                "./waf build -j $FLATPAK_BUILDER_N_JOBS",
                "./waf install"
            ],
            "cleanup": [
                "/bin",
                "/share",
                "/lib/jack",
                "/lib/libjackserver.so*"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://lv2plug.in/spec/lv2-1.16.0.tar.bz2",
                    "sha256": "dec3727d7bd34a413a344a820678848e7f657b5c6019a0571c61df76d7bdf1de"
                }
            ]
        },

        {
            "name": "libglade",
            "rm-configure": true,
            "cleanup": [
                "/bin"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.gnome.org/pub/GNOME/sources/libglade/2.6/libglade-2.6.4.tar.gz",
                    "sha256": "c41d189b68457976069073e48d6c14c183075d8b1d8077cb6dfb8b7c5097add3"
                },
                {
                    "type": "shell",
                    "commands": [
                        "rm -f config.guess"
                    ]
                },
                {
                    "type": "script",
                    "commands": [
                        "autoreconf -fiv"
                    ],
                    "dest-filename": "autogen.sh"
                }
            ]
        },
        {
            "name": "fluidsynth",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DLIB_SUFFIX="
            ],
            "cleanup": [
                "/include"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/FluidSynth/fluidsynth/archive/v2.0.8.tar.gz",
                    "sha256": "0c37e72db31d1b35e587b94b7163d68444cffaa9e7fe8a293d79957620bff117"
                }
            ]
        },
        {
            "name": "cmt",
            "buildsystem": "simple",
            "build-commands": [
                "sed -i -e 's~/usr/lib/ladspa~/app/lib/ladspa~g' src/Makefile",
                "cd src && make",
                "cd src && make install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.ladspa.org/download/cmt_1.17.tgz",
                    "sha256": "eb56d7abebfdf8a6d0ad65d012238c9fc394dd41eeca11900812a8cb6b07ad1f"
                }
            ]
        },
        
        {
            "name": "invada-studio-plugins-lv2",
            "buildsystem": "simple",
            "build-commands": [
                "sed -i -e 's~/usr/local/lib/lv2~/app/lib/lv2~g' Makefile",
                "make",
                "make install-sys"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://launchpad.net/invada-studio/lv2/1.2/+download/invada-studio-plugins-lv2_1.2.0-0.tar.gz",
                    "sha256": "9e67af0ebc8a6394b50785034b368573c8a9241dd2500bdc91905977b94f8209"
                }
            ]
        },

        {
            "name": "calf-lv2",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://calf-studio-gear.org/files/calf-0.90.2.tar.gz",
                    "sha256": "f0e9d36990ece7ae6334166ced5a2e02bbd8bcd2aa2ecad0efce0b4e6790c42e"
                }
            ]
        },
        
        {
            "name": "chrpath",
            "cleanup": ["*"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://src.fedoraproject.org/lookaside/extras/chrpath/chrpath-0.16.tar.gz/2bf8d1d1ee345fc8a7915576f5649982/chrpath-0.16.tar.gz",
                    "sha256": "bb0d4c54bac2990e1bdf8132f2c9477ae752859d523e141e72b3b11a12c26e7b"
                }
            ]
        },
        
        {
            "name": "libsoup",
            "buildsystem": "meson",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/libsoup/2.66/libsoup-2.66.1.tar.xz",
                    "sha256": "4a2cb6c1174540af13661636035992c2b179dfcb39f4d3fa7bee3c7e355c43ff"
                }
            ]
        },

        {
            "name": "libsecret",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/libsecret/0.18/libsecret-0.18.8.tar.xz",
                    "sha256": "3bfa889d260e0dbabcf5b9967f2aae12edcd2ddc9adc365de7a5cc840c311d15"
                }
            ]
        },

        {
            "name": "enchant",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AbiWord/enchant/releases/download/v2.2.3/enchant-2.2.3.tar.gz",
                    "sha256": "abd8e915675cff54c0d4da5029d95c528362266557c61c7149d53fa069b8076d"
                }
            ]
        },
        
        {
            "name": "gnome-common",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/gnome-common/3.18/gnome-common-3.18.0.tar.xz",
                    "sha256": "22569e370ae755e04527b76328befc4c73b62bfd4a572499fde116b8318af8cf"
                }
            ]
        },
        

        {
            "name": "libnotify",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.8.tar.xz",
                    "sha256": "69209e0b663776a00c7b6c0e560302a8dbf66b2551d55616304f240bba66e18c"
                }
            ]
        },
        
        {
            "name": "openjpeg",
            "buildsystem": "cmake-ninja",
            "builddir": "true",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/uclouvain/openjpeg/archive/v2.3.1.tar.gz",
                    "sha256": "63f5a4713ecafc86de51bfad89cc07bb788e9bba24ebbf0c4ca637621aadb6a9"
                }
            ]
        },

        {
            "name": "brotli",
            "buildsystem": "cmake-ninja",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/google/brotli/archive/v1.0.7.tar.gz",
                    "sha256": "4c61bfb0faca87219ea587326c467b95acb25555b53d1a421ffa3c8a9296ee2c"
                }
            ]
        },

        {
            "name": "woff2",
            "buildsystem": "cmake-ninja",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/google/woff2/archive/v1.0.2.tar.gz",
                    "sha256": "add272bb09e6384a4833ffca4896350fdb16e0ca22df68c0384773c67a175594"
                }
            ]
        },

        {
            "name": "webkitgtk",
            "buildsystem": "cmake-ninja",
            "builddir": "true",
            "build-options": [
                {
                    "cflags": "-g1",
                    "cxxflags": "-g1",
                    "arch": [
                        {
                            "i386": [
                                {
                                    "ldflags": "-Wl,--no-keep-memory",
                                    "config-opts": [
                                        "-DCMAKE_SYSTEM_PROCESSOR=i586"
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ],
            "config-opts": [
                "-DPORT=GTK",
                "-DCMAKE_BUILD_TYPE=Release",
                "-DENABLE_PLUGIN_PROCESS_GTK2=OFF",
                "-DENABLE_GTKDOC=OFF",
                "-DENABLE_MINIBROWSER=OFF",
                "-DPYTHON_EXECUTABLE=/usr/bin/python3"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://webkitgtk.org/releases/webkitgtk-2.24.1.tar.xz",
                    "sha256": "53cb8eaad2ca4caaae663d68331b83fd27d5bd5f6c5388d6ea3c455e338f396d"
                },
                {
                    "type": "patch",
                    "path": "patches/webkitgtk-2-24-1-revert-sse2.patch"
                }
            ]
        },
        
        {
            "name": "gsequencer",
            "config-opts": [
                "--disable-introspection",
                "--enable-gtk-doc",
                "--enable-gtk-doc-html",
		"HTMLHELP_XSL=/usr/share/xml/docbook/xml/xsl-stylesheets/htmlhelp/htmlhelp.xsl"
            ],
            "post-install": [
                "make html",
                "make fix-local-html",
                "make install-html-mkdir",
                "make install-html-mkdir-links",
                "make install-html",
                "make install-html-links",
                "sed -i -e 's~Icon=/app/share/gsequencer/icons/ags.png~Icon=org.nongnu.gsequencer.gsequencer.png~g' /app/share/applications/gsequencer.desktop",
                "chrpath -d /app/lib/gsequencer/libgsequencer.so"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download-mirror.savannah.gnu.org/releases/gsequencer/3.0.x/gsequencer-3.0.3.tar.gz",
                    "sha256": "267bb0ff1cfc64ad7923f5da127fa2a3616901b023863841468d240fa4f65b95"

                },
                {
                    "type": "shell",
                    "commands": [
                        "mkdir -p /app/share/gsequencer && cp -v COPYING /app/share/gsequencer/GPL-3"
                    ]
                }
            ],
            "cleanup": [
		"/share/doc/libags-doc",
		"/share/doc/libags-audio-doc",
		"/share/doc/libags-gui-doc",
		"/share/doc/libgsequencer-doc"
	    ]
        }
    ]
}
